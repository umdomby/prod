
Балансировка нагрузки:

Добавим несколько серверов в блок upstream для распределения нагрузки между ними.

Настроим алгоритм балансировки (например, round-robin, least_conn, ip_hash).

Обратный прокси:

Убедимся, что все запросы перенаправляются на соответствующие серверы через proxy_pass.

Добавим настройки для улучшения производительности и безопасности.

Отказоустойчивость:

Добавим параметры max_fails и fail_timeout для автоматического исключения неработающих серверов.



Что изменилось?
Балансировка нагрузки:

В блоке upstream добавлены несколько серверов (nextjs1, nextjs2, nextjs3).

Используется алгоритм least_conn для балансировки по минимальному количеству соединений.

Добавлен резервный сервер (backup), который включается, если основные серверы недоступны.

Обратный прокси:

Все запросы перенаправляются через proxy_pass на upstream backend.

Добавлены настройки для улучшения производительности:

proxy_connect_timeout, proxy_send_timeout, proxy_read_timeout — таймауты для соединения, отправки и чтения данных.

proxy_next_upstream — автоматическое переключение на другой сервер в случае ошибок.

Отказоустойчивость:

Параметры max_fails и fail_timeout автоматически исключают неработающие серверы из балансировки.

Как это работает?
Запросы на anybet.site, anycoin.site и ardu.site перенаправляются на серверы из upstream backend.

Если один из серверов (nextjs1 или nextjs2) становится недоступным, Nginx автоматически переключается на другой сервер.

Если оба основных сервера недоступны, используется резервный сервер (nextjs3).

Рекомендации
Мониторинг:

Настройте мониторинг серверов (например, с помощью Prometheus и Grafana), чтобы отслеживать их состояние.

Тестирование:

Проверьте балансировку нагрузки, отключив один из серверов и убедившись, что Nginx переключается на другой.

SSL:

Убедитесь, что SSL-сертификаты для всех доменов настроены правильно.